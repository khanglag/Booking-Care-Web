steps:
  - name: 'gcr.io/cloud-builders/mvn'
    args: [ 'clean', 'package' ]
    dir: '.'
    secretEnv:
      - 'API_CHAT_GPT'
      - 'API_KEY'
      - 'FACEBOOK_APP_ID'
      - 'FACEBOOK_CLIENT_SECRET'
      - 'GITHUB_CLIENT_ID'
      - 'GITHUB_CLIENT_SECRET'
      - 'GOOGLE_CLIENT_SECRET'
      - 'GOOGLE_GEMINI_API'
      - 'GOOGLE_CLIENT_ID'

  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'app', 'deploy' ]
    dir: '.'
    secretEnv:
      - 'API_CHAT_GPT'
      - 'API_KEY'
      - 'FACEBOOK_APP_ID'
      - 'FACEBOOK_CLIENT_SECRET'
      - 'GITHUB_CLIENT_ID'
      - 'GITHUB_CLIENT_SECRET'
      - 'GOOGLE_CLIENT_SECRET'
      - 'GOOGLE_GEMINI_API'
      - 'GOOGLE_CLIENT_ID'

timeout: 900s
options:
  default_logs_bucket_behavior: REGIONAL_USER_OWNED_BUCKET

secrets:
  - secretManager:
      version: "latest"
      secret: "SOCIAL_OAUTH_SECRETS"
